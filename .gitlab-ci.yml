image: mcr.microsoft.com/dotnet/sdk:3.1

before_script:
  - 'dotnet restore GestionStock'
  - 'dotnet restore GestionStockTest'

stages:
    - Build
    - Test

GestionStock:
  stage: Build
  script:
    - 'dotnet build --no-restore GestionStock'
  allow_failure: false

GestionStockTest:
  stage: Build
  script:
    - 'dotnet build --no-restore GestionStockTest'
  allow_failure: false

UnitTests:
  stage: Test
  script:
    - 'dotnet test --no-restore GestionStockTest'
  allow_failure: false


sonarqube-check:
  stage: Test
  image:
    name: sonarsource/sonar-scanner-cli:latest
    entrypoint: [""]
  variables:
    SONAR_USER_HOME: "${CI_PROJECT_DIR}/.sonar"  # Defines the location of the analysis task cache
    GIT_DEPTH: "0"  # Tells git to fetch all the branches of the project, required by the analysis task
  cache:
    key: "${CI_JOB_NAME}"
    paths:
      - .sonar/cache
  script:
    - sonar-scanner -Dsonar.qualitygate.wait=true -Dsonar.projectKey=vitejs-sample -Dsonar.sources=. -Dsonar.host.url=0.0.0.0:9000 -Dsonar.login=b8d98ef101d0c51fb6b108f3cd19f2a640968de3
  allow_failure: true
  only:
    - master


